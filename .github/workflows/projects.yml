strategy:
  matrix:
    project: ${{ 
      fromJSON(
        github.event_name == 'workflow_dispatch' 
          && !isEmpty(inputs.extra_projects)
            ? format(
                '[{0}]',
                join(
                  union(
                    filter(fromJSON(env.ALL_PROJECTS), item -> inputs[item] == true),
                    filter(split(inputs.extra_projects, ','), item -> trim(item) != '')
                  ),
                  ','
                )
              )
          || github.event_name == 'workflow_dispatch'
            ? toJSON(filter(fromJSON(env.ALL_PROJECTS), item -> inputs[item] == true))
          : env.ALL_PROJECTS
      )
    }}
